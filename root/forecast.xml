<?xml version="1.0"?>
<weather_forecast xmlns:atom="http://www.w3.org/2005/Atom" version="1.6">
  <atom:link rel="self" href="http://128.11.138.31/weather/[% zip %]/forecast"/>
  <atom:link rel="http://www.api.ing.carrier.com/rels/weather" href="http://128.11.138.31/weather/[% zip %]"/>
  <timestamp>[% dt.iso8601 %].01234Z</timestamp>
  <ping>2</ping>
  [% SET status = ['',
    'Thunderstorms',
    'Sleet',
    'Rain and Sleet',
    'Wintry Mix',
    'Rain and Snow',
    'Snow',
    'Freezing Rain',
    'Rain',
    'Blizzard',
    'Fog',
    'Cloudy',
    'Partly Cloudy',
    'Mostly Cloudy',
    'Sunny'
  ] %]
  [% 
    SET today = dt.set_time_zone( time_zone || 'America/New_York' ) ;
    CALL dt.set_hour(0).set_minute(0).set_second(0);
  %]
  [% FOREACH i = [0 .. 5] %]
  <day id="[% today.day_name %]">
    <timestamp>[% today %][% today.offset / 3600 %]:00</timestamp>
    <min_temp units="f">[% i+1 %]</min_temp>
    <max_temp units="f">[% i+1*4 %]</max_temp>
    <status_id>[% SET status_id=i*2+4; status_id; %]</status_id>
    <status_message>[% status.$status_id %]</status_message>
    <pop>[% i*10 %]</pop>
  </day>
  [% CALL today.add(days=>1) %]
  [% END %]
</weather_forecast>
